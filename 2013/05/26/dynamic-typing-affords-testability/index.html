<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Raleway' rel='stylesheet' type='text/css'>
    <title>Dynamic Typing Affords Testability - Lee Dohm's Blog</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="alternate" type="application/atom+xml" href="/feed.xml"/>
    <link rel="icon" type="image/png" href="/favicon-icon.png"/>

    <!-- Bootstrap -->
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen" />

    <!-- Site -->
    <link href="/stylesheets/styles.css" rel="stylesheet" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- MathJax -->
    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17382346-2', 'lee-dohm.com');
  ga('send', 'pageview');

</script>
    <meta property="og:title" content="Dynamic Typing Affords Testability"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://www.lee-dohm.com/2013/05/26/dynamic-typing-affords-testability/"/>
<meta property="og:image" content="http://www.lee-dohm.com/favicon-icon.png"/>
<meta property="og:description" content=""/>


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-custom" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Lee Dohm</a>
        <p class="navbar-text">Games and Technology Should Include EVERYone</p>
      </div>

      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/archives">Archive</a></li>
          <li><a href="/feed.xml">Feed</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="/about">About Lee</a></li>
              <li><a href="/this-blog">About This Blog</a></li>
              <li><a href="/appearances">Appearances</a></li>
              <li><a href="/colophon">Colophon</a></li>
              <li><a href="/disclaimer">Disclaimers</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <div class="row">
        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<div class="content">
  <h1><a class="title" href="/2013/05/26/dynamic-typing-affords-testability/"><p>Dynamic Typing Affords Testability</p>
</a></h1>
  <h4 class="dateline">
    May 26, 2013
    •
    <a href="/2013/05/26/dynamic-typing-affords-testability/"><span class="octicon octicon-link"></span></a>
  </h4>

  <p>I read <a href="http://sebastiansylvan.wordpress.com/2013/05/25/language-design-deal-breakers/">this article on language design “deal breakers”</a>. It is a thought-provoking read despite the fact that the author and I do not agree on a couple key points. Where we do agree is with regards to memory safety, both in allocation and with respect to null references, and efficient storage reclamation. I’m much less concerned than the author about Windows support though I can understand why someone would include it in their “deal breaker” list. Where I definitely don’t agree is on the benefits of static typing and this reminded me that I had been meaning to write about dynamic typing and how it affords testability.</p>

<p>The author states in their article:</p>

<blockquote>
<p>Examples of code you probably don’t want to write unit tests for includes gameplay logic which gets written and rewritten twenty times before ship as the result of iteration. Having to write test harnesses and tests for all this throwaway code is madness. Then of course there’s code that’s just plain hard to unit test, such as graphics. The point is that pervasive unit testing is a fantasy - it may be feasible in some domains, but it’s certainly not the case everywhere.</p>
</blockquote>

<p>The author states that automated testing isn’t valuable in all cases. Part of that reason appears to be that the author rightly states that automated testing, even at the unit test level, is hard … at least in statically typed languages.</p>

<p>Let’s step back a moment and define our terms. A language can be considered “statically typed” if type correctness is checked at compile-time and “dynamically typed” if type correctness is not checked at compile-time.<sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup> What it means to be “type correct” varies from language to language, so we won’t examine a more formal definition of that here. Languages like Java and Go are statically typed while languages like Ruby and Python are dynamically typed.</p>

<p>I’m going to take a look at the problem from the point of view of <a href="http://en.wikipedia.org/wiki/Dependency_injection">dependency injection</a>. Dependency injection is a very important capability in testing software in an automated fashion. This is a simple example in Java:</p>
<div class="highlight"><pre><a name="line-1"></a><span class="kd">class</span> <span class="nc">A</span>
<a name="line-2"></a><span class="o">{</span>
<a name="line-3"></a>    <span class="kd">private</span> <span class="n">B</span> <span class="n">b</span><span class="o">;</span>
<a name="line-4"></a>
<a name="line-5"></a>    <span class="kd">public</span> <span class="nf">A</span><span class="o">(</span><span class="n">B</span> <span class="n">b</span><span class="o">)</span>
<a name="line-6"></a>    <span class="o">{</span>
<a name="line-7"></a>        <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span>
<a name="line-8"></a>    <span class="o">}</span>
<a name="line-9"></a>
<a name="line-10"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">store</span><span class="o">()</span>
<a name="line-11"></a>    <span class="o">{</span>
<a name="line-12"></a>        <span class="c1">// Stores important things into the database</span>
<a name="line-13"></a>        <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">store</span><span class="o">();</span>
<a name="line-14"></a>    <span class="o">}</span>
<a name="line-15"></a><span class="o">}</span>
</pre></div>
<p>The class <code>A</code> depends on some <code>B</code> to store information in the database, whether <code>B</code> is a concrete class or simply an interface doesn’t really matter from the point of view of <code>A</code>. <code>A</code> is well-factored and, for a statically typed language, easily testable. If <code>B</code> is a class, we could test it this way:</p>
<div class="highlight"><pre><a name="line-1"></a><span class="kd">class</span> <span class="nc">MockB</span> <span class="kd">extends</span> <span class="n">B</span>
<a name="line-2"></a><span class="o">{</span>
<a name="line-3"></a>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">storeCalled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<a name="line-4"></a>
<a name="line-5"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">store</span><span class="o">()</span>
<a name="line-6"></a>    <span class="o">{</span>
<a name="line-7"></a>        <span class="k">this</span><span class="o">.</span><span class="na">storeCalled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<a name="line-8"></a>    <span class="o">}</span>
<a name="line-9"></a><span class="o">}</span>
<a name="line-10"></a>
<a name="line-11"></a><span class="kd">class</span> <span class="nc">ATest</span>
<a name="line-12"></a><span class="o">{</span>
<a name="line-13"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">storeTest</span><span class="o">()</span>
<a name="line-14"></a>    <span class="o">{</span>
<a name="line-15"></a>        <span class="n">MockB</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MockB</span><span class="o">();</span>
<a name="line-16"></a>        <span class="n">A</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">A</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
<a name="line-17"></a>
<a name="line-18"></a>        <span class="n">a</span><span class="o">.</span><span class="na">store</span><span class="o">();</span>
<a name="line-19"></a>
<a name="line-20"></a>        <span class="k">assert</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">storeCalled</span><span class="o">);</span>
<a name="line-21"></a>    <span class="o">}</span>
<a name="line-22"></a><span class="o">}</span>
</pre></div>
<p>We simply create a descendant of <code>B</code> that stubs out the method we want to test and supply that to the constructor of <code>A</code>. If <code>B</code> is an interface, the code is almost identical:</p>
<div class="highlight"><pre><a name="line-1"></a><span class="kd">class</span> <span class="nc">MockB</span> <span class="kd">implements</span> <span class="n">B</span>
<a name="line-2"></a><span class="o">{</span>
<a name="line-3"></a>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">storeCalled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<a name="line-4"></a>
<a name="line-5"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">store</span><span class="o">()</span>
<a name="line-6"></a>    <span class="o">{</span>
<a name="line-7"></a>        <span class="k">this</span><span class="o">.</span><span class="na">storeCalled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<a name="line-8"></a>    <span class="o">}</span>
<a name="line-9"></a><span class="o">}</span>
</pre></div>
<p>At least in this very simplified example. If <code>B</code> had not one method, but ten or twenty then the <code>MockB</code> for that version would be much more complicated even if <code>store()</code> is all we wanted to override. At the very least, we would have to implement all of those methods to throw an exception of some sort.<sup id="fnref2"><a href="#fn2" rel="footnote">2</a></sup></p>

<p>But, as is sometimes the case in these situations, perhaps <code>B</code> is declared in a library that we don’t have the source to recompile from. And perhaps it is declared like this:</p>
<div class="highlight"><pre><a name="line-1"></a><span class="kd">class</span> <span class="nc">B</span>
<a name="line-2"></a><span class="o">{</span>
<a name="line-3"></a>    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">store</span><span class="o">()</span>
<a name="line-4"></a>    <span class="o">{</span>
<a name="line-5"></a>        <span class="c1">// Writes to the database</span>
<a name="line-6"></a>    <span class="o">}</span>
<a name="line-7"></a><span class="o">}</span>
</pre></div>
<p>That <code>final</code> keyword means that subclasses of <code>B</code> cannot override the <code>store</code> method.<sup id="fnref3"><a href="#fn3" rel="footnote">3</a></sup> What does one do in this case? Well, this is where things get weird. Because <code>B</code> doesn’t implement an interface nor descend from any parent class that we can use in its stead,<sup id="fnref4"><a href="#fn4" rel="footnote">4</a></sup> we have to do some gymnastics to essentially work around the type system:</p>
<div class="highlight"><pre><a name="line-1"></a><span class="kd">class</span> <span class="nc">MockB</span>
<a name="line-2"></a><span class="o">{</span>
<a name="line-3"></a>    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">mock</span><span class="o">;</span>
<a name="line-4"></a>    <span class="kd">private</span> <span class="n">B</span> <span class="n">b</span><span class="o">;</span>
<a name="line-5"></a>
<a name="line-6"></a>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">storeCalled</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<a name="line-7"></a>
<a name="line-8"></a>    <span class="kd">public</span> <span class="nf">MockB</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">mock</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<a name="line-9"></a>    <span class="o">{</span>
<a name="line-10"></a>        <span class="k">this</span><span class="o">.</span><span class="na">mock</span> <span class="o">=</span> <span class="n">mock</span><span class="o">;</span>
<a name="line-11"></a>
<a name="line-12"></a>        <span class="k">if</span><span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">mock</span><span class="o">)</span>
<a name="line-13"></a>        <span class="o">{</span>
<a name="line-14"></a>            <span class="k">this</span><span class="o">.</span><span class="na">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">B</span><span class="o">();</span>
<a name="line-15"></a>        <span class="o">}</span>
<a name="line-16"></a>    <span class="o">}</span>
<a name="line-17"></a>
<a name="line-18"></a>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">store</span><span class="o">()</span>
<a name="line-19"></a>    <span class="o">{</span>
<a name="line-20"></a>        <span class="k">if</span><span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">mock</span><span class="o">)</span>
<a name="line-21"></a>        <span class="o">{</span>
<a name="line-22"></a>            <span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">store</span><span class="o">();</span>
<a name="line-23"></a>        <span class="o">}</span>
<a name="line-24"></a>        <span class="k">else</span>
<a name="line-25"></a>        <span class="o">{</span>
<a name="line-26"></a>            <span class="k">this</span><span class="o">.</span><span class="na">storeCalled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<a name="line-27"></a>        <span class="o">}</span>
<a name="line-28"></a>    <span class="o">}</span>
<a name="line-29"></a><span class="o">}</span>
</pre></div>
<p>Yes, this gets the job done. But this version of <code>MockB</code> is now part of our <em>production</em> code because <code>A</code> has to be rewritten to accept a <code>MockB</code> instead of a <code>B</code>. It is going to ship with our product and could be a source of bugs. It also will be a performance hit, albeit perhaps an infinitesimally small one. Every time <code>A</code> would have called a method on <code>B</code>, a check is made to see if we are testing or not … a check that shouldn’t need to be performed in production code. This is also a violation of the <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">Single Responsibility Principle</a>, in that this new class is responsible both for being a stand-in for <code>B</code> as well as being responsible for affording testing.</p>

<p>In a dynamically typed language though, such as Ruby, all of these concerns and code changes go away. Let’s take a look at the Ruby version of <code>A</code>:</p>
<div class="highlight"><pre><a name="line-1"></a><span class="k">class</span> <span class="nc">A</span>
<a name="line-2"></a>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<a name="line-3"></a>    <span class="vi">@b</span> <span class="o">=</span> <span class="n">b</span>
<a name="line-4"></a>  <span class="k">end</span>
<a name="line-5"></a>
<a name="line-6"></a>  <span class="k">def</span> <span class="nf">store</span>
<a name="line-7"></a>    <span class="c1"># Stores important things into the database</span>
<a name="line-8"></a>    <span class="vi">@b</span><span class="o">.</span><span class="n">store</span>
<a name="line-9"></a>  <span class="k">end</span>
<a name="line-10"></a><span class="k">end</span>
</pre></div>
<p>Because the type of the <code>b</code> parameter doesn’t matter, we can create a class that does exactly what we want, similar to the first version of <code>MockB</code> in Java above. And better yet, it doesn’t matter if <code>B</code> is a class or an interface, open or closed, the code for the test is the same, so all the different versions of <code>MockB</code> that we had to worry about for Java are not necessary in Ruby.</p>

<p>This is just one example of how dynamic typing makes completely automated testing significantly easier. Static typing may catch one small class of bugs sooner, but automated testing has the potential of catching <em>all</em> classes of bugs sooner.</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>These ideas are separate from the concepts of a “strongly typed” or “weakly typed” language, which do not have strict definitions. <a href="#fnref1" rev="footnote">↩</a></p>
</li>

<li id="fn2">
<p>In Java though, this might run afoul of checked exceptions depending on how we decided to do it. <a href="#fnref2" rev="footnote">↩</a></p>
</li>

<li id="fn3">
<p>There are similar challenges in other statically typed languages like C++ and C# where the author of a class can completely prevent subclassing as a means of providing dependency injection. <a href="#fnref3" rev="footnote">↩</a></p>
</li>

<li id="fn4">
<p>In the case of Java, of course, it descends from <code>Object</code>, but that isn’t helpful here. <a href="#fnref4" rev="footnote">↩</a></p>
</li>

</ol>
</div>

</div>
</body></html>

          </div>
        </div>

        <div class="col-md-8 col-md-offset-2">
          <hr/>
          <div class="text-center">
            <p>
              <a href="mailto:lee@lee-dohm.com"><span class="octicon octicon-mail"></span></a>&nbsp;&nbsp;
              <a href="https://github.com/lee-dohm"><span class="octicon octicon-mark-github"></span></a>&nbsp;&nbsp;
              <a href="http://stackoverflow.com/users/1954/lee"><i class="fa fa-stack-exchange"></i></a>&nbsp;&nbsp;
              <a href="https://twitter.com/leedohm"><i class="fa fa-twitter"></i></a>
            </p>
            <p>
              Copyright &copy; 2010-2016 by Lee Dohm
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/javascripts/lightbox.min.js"></script>
    <script src="/javascripts/bigfoot.min.js"></script>
    <script type="text/javascript">
      $.bigfoot();
    </script>
  </body>
</html>

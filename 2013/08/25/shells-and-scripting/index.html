<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic|Raleway' rel='stylesheet' type='text/css'>
    <title>Shells and Scripting - Lee Dohm's Blog</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="alternate" type="application/atom+xml" href="/feed.xml"/>
    <link rel="icon" type="image/png" href="/favicon-icon.png"/>

    <!-- Bootstrap -->
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen" />

    <!-- Site -->
    <link href="/stylesheets/styles.css" rel="stylesheet" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- MathJax -->
    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-17382346-2', 'lee-dohm.com');
  ga('send', 'pageview');

</script>
    <meta property="og:title" content="Shells and Scripting"/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://www.lee-dohm.com/2013/08/25/shells-and-scripting/"/>
<meta property="og:image" content="http://www.lee-dohm.com/favicon-icon.png"/>
<meta property="og:description" content=""/>


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-custom" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Lee Dohm</a>
        <p class="navbar-text">Games and Technology Should Include EVERYone</p>
      </div>

      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/archives">Archive</a></li>
          <li><a href="/feed.xml">Feed</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="/about">About Lee</a></li>
              <li><a href="/this-blog">About This Blog</a></li>
              <li><a href="/appearances">Appearances</a></li>
              <li><a href="/colophon">Colophon</a></li>
              <li><a href="/disclaimer">Disclaimers</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <div class="row">
        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<div class="content">
  <h1><a class="title" href="/2013/08/25/shells-and-scripting/"><p>Shells and Scripting</p>
</a></h1>
  <h4 class="dateline">
    August 25, 2013
    •
    <a href="/2013/08/25/shells-and-scripting/"><span class="octicon octicon-link"></span></a>
  </h4>

  <p>I’ve spent a significant chunk of my weekend playing around with a new command-line shell, <a href="http://www.fishshell.com">fish</a>, the <strong>F</strong>riendly <strong>I</strong>nteractive <strong>SH</strong>ell. I’d seen people using it on a couple of screencasts and thought about checking it out for quite a while. I finally got around to it …</p>

<p>It was a little frustrating to work with at first because it is designed to be simpler to use and therefore friendlier than other shells, so I had to convert some of the ways I was doing things in my older shell, <a href="http://www.zsh.org/">zsh</a>, to the new way of doing things. But after I got done replicating all of my environment customizations in fish, it turns out that my fish configuration is <em>tons</em> simpler than the one in zsh. I was pretty impressed, so I’ve switched over my main computer and will probably switch over my work computers this week. But as I worked with it, something bothered me.</p>

<p>It is interesting that with all the progress in computers over the last few decades, we still use command-line environments that have remained largely unchanged since about the 1980s. In the 80s many people were still writing significant amounts of code in BASIC, COBOL, Fortran and other primitive languages. We have rightly done away with those archaic systems and replaced them with much more modern ones. But what languages that should have gone the way of Latin and Sanskrit do I still see people writing whole programs in? Shell scripts.<sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup></p>

<p>It’s true that the scripting language in fish is <em>much</em> simpler and more consistent than zsh or <a href="http://www.gnu.org/software/bash/">bash</a>, but I have never seen a shell scripting language that can hold a candle to even the worst modern scripting language,<sup id="fnref2"><a href="#fn2" rel="footnote">2</a></sup> let alone one of the better ones. There is one and only one capability that shell scripting languages have that other languages can’t easily replicate: setting environment variables. But environment variables are the <strong>globalest</strong> of global variables … not only can they be read or written anywhere in your program like normal global variables but environment variables can be read, and if you’re writing shell scripts written, by <em>other</em> programs too! There are other ways to communicate state between programs now people! <img alt="rage" src="/images/emoji/rage.png" class="emoji" /></p>

<p>Other than raw capabilities programming-wise, there is one other argument for these languages of yesteryear. That is their ubiquity. Every Unix machine comes with bash already installed. Every single Windows machine and every DOS machine before that can run batch files. But it is also their ubiquity that ties them down, that ossifies them, to the point where they go for decades without changing, without keeping up with the times. And in this day and age of always-on Internet connections and easy-to-use <a href="http://brew.sh">package</a> <a href="http://en.wikipedia.org/wiki/Advanced_Packaging_Tool">managers</a>, installing something better is only a few keystrokes away.</p>

<p>Let’s take a look at an example. I wrote some code to reorder the <code>PATH</code> environment variable in fish. It does the following:</p>

<ol>
<li>Locates <code>/usr/bin</code> and <code>/usr/local/bin</code> in the <code>PATH</code>
</li>
<li>If <code>/usr/local/bin</code> is <em>after</em> <code>/usr/bin</code> it:

<ol>
<li>Removes <code>/usr/local/bin</code>
</li>
<li>Inserts <code>/usr/local/bin</code> just before <code>/usr/bin</code>
</li>
</ol>
</li>
</ol>

<p>This is the implementation in fish:</p>
<div class="highlight"><pre><a name="line-1"></a><span class="nb">set</span> --local bin_index <span class="o">(</span>contains --index /usr/bin <span class="nv">$PATH</span><span class="o">)</span>
<a name="line-2"></a><span class="nb">set</span> --local local_bin_index <span class="o">(</span>contains --index /usr/local/bin <span class="nv">$PATH</span><span class="o">)</span>
<a name="line-3"></a>
<a name="line-4"></a><span class="k">if</span> <span class="nb">test</span> <span class="nv">$local_bin_index</span> -gt <span class="nv">$bin_index</span>
<a name="line-5"></a>    <span class="nb">set</span> --erase <span class="nv">$PATH</span><span class="o">[</span><span class="nv">$local_bin_index</span><span class="o">]</span>
<a name="line-6"></a>
<a name="line-7"></a>    <span class="nb">set</span> --local local_path <span class="s1">''</span>
<a name="line-8"></a>    <span class="k">if</span> <span class="nb">test</span> <span class="o">(</span>math <span class="nv">$bin_index</span> - 1<span class="o">)</span> -gt 0
<a name="line-9"></a>        <span class="nb">set </span>local_path <span class="nv">$PATH</span><span class="o">[</span>1..<span class="o">(</span>math <span class="nv">$bin_index</span> - 1<span class="o">)]</span>
<a name="line-10"></a>    end
<a name="line-11"></a>
<a name="line-12"></a>    <span class="nb">set </span>local_path <span class="nv">$local_path</span> /usr/local/bin
<a name="line-13"></a>    <span class="nb">set </span>local_path <span class="nv">$local_path</span> <span class="nv">$PATH</span><span class="o">[</span><span class="nv">$bin_index</span>..-1<span class="o">]</span>
<a name="line-14"></a>
<a name="line-15"></a>    <span class="nb">set</span> --global --export PATH <span class="nv">$local_path</span>
<a name="line-16"></a>end
</pre></div>
<p>And here is the equivalent Ruby code:</p>
<div class="highlight"><pre><a name="line-1"></a><span class="n">path</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'PATH'</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="sr">/:/</span><span class="p">)</span>
<a name="line-2"></a>
<a name="line-3"></a><span class="n">bin_index</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">find_index</span><span class="p">(</span><span class="s1">'/usr/bin'</span><span class="p">)</span>
<a name="line-4"></a><span class="n">local_bin_index</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">find_index</span><span class="p">(</span><span class="s1">'/usr/local/bin'</span><span class="p">)</span>
<a name="line-5"></a>
<a name="line-6"></a><span class="k">if</span> <span class="n">local_bin_index</span> <span class="o">&gt;</span> <span class="n">bin_index</span>
<a name="line-7"></a>  <span class="n">path</span><span class="o">.</span><span class="n">delete_at</span><span class="p">(</span><span class="n">local_bin_index</span><span class="p">)</span>
<a name="line-8"></a>  <span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">bin_index</span><span class="p">,</span> <span class="s1">'/usr/local/bin'</span><span class="p">)</span>
<a name="line-9"></a>
<a name="line-10"></a>  <span class="no">ENV</span><span class="o">[</span><span class="s1">'PATH'</span><span class="o">]</span> <span class="o">=</span> <span class="n">path</span>
<a name="line-11"></a><span class="k">end</span>
</pre></div>
<p>Ruby has a reputation for being concise, so let’s not look at line counts and such.<sup id="fnref3"><a href="#fn3" rel="footnote">3</a></sup> But the <em>clarity</em> of the code is clearly worse in fish … maybe not a lot worse, but worse all the same. I don’t count this as a fault of fish shell. It isn’t meant to be a general-purpose programming language and the code here is <em>much</em> more concise, readable, understandable and maintainable than the same thing would be in bash! The fish language is way ahead of other shell scripting languages,<sup id="fnref4"><a href="#fn4" rel="footnote">4</a></sup> but that’s not a high bar. I mean, it’s on their homepage, “Finally, a command line shell for the 90s”. And they’re joking, but only just.</p>

<p>What this all boils down to is that I’m all for shell scripts that allow you to customize your working environment. Or shell scripts that make a simple task even simpler.<sup id="fnref5"><a href="#fn5" rel="footnote">5</a></sup> But if a shell script grows to over 20 lines of code, or you’re confronted with error handling, or you start namespacing your environment variables so they don’t clash <img alt="sob" src="/images/emoji/sob.png" class="emoji" />, or you start constructing a series of libraries to manage all the shell code you have <img alt="confounded" src="/images/emoji/confounded.png" class="emoji" />, it is time to rewrite it in a real programming language. The command line is a great place to execute <em>ad hoc</em> commands to deal with one-off tasks<sup id="fnref6"><a href="#fn6" rel="footnote">6</a></sup> but shell scripts are not a replacement for real code.</p>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>This includes <a href="http://en.wikipedia.org/wiki/Batch_files">batch files</a> on Windows as well. <a href="#fnref1" rev="footnote">↩</a></p>
</li>

<li id="fn2">
<p>I nominate Perl. <img alt="laughing" src="/images/emoji/laughing.png" class="emoji" /> <a href="#fnref2" rev="footnote">↩</a></p>
</li>

<li id="fn3">
<p>Ok, I can’t resist. I’ll just put it down here in a footnote. The fish implementation is 60% larger by line count and 88% larger by character count! <img alt="scream" src="/images/emoji/scream.png" class="emoji" /> <a href="#fnref3" rev="footnote">↩</a></p>
</li>

<li id="fn4">
<p>With the possible exception of <a href="http://technet.microsoft.com/en-us/scriptcenter/powershell.aspx">Windows PowerShell</a>. <a href="#fnref4" rev="footnote">↩</a></p>
</li>

<li id="fn5">
<p>If you want to see what sorts of things I automate at the command line, check out my <a href="https://github.com/lee-dohm/environment">environment project</a> on GitHub. <a href="#fnref5" rev="footnote">↩</a></p>
</li>

<li id="fn6">
<p>Though both Python and Ruby come with <a href="http://en.wikipedia.org/wiki/REPL">REPL</a> environments that serve a very similar purpose. <a href="#fnref6" rev="footnote">↩</a></p>
</li>

</ol>
</div>

</div>
</body></html>

          </div>
        </div>

        <div class="col-md-8 col-md-offset-2">
          <hr/>
          <div class="text-center">
            <p>
              <a href="mailto:lee@lee-dohm.com"><span class="octicon octicon-mail"></span></a>&nbsp;&nbsp;
              <a href="https://github.com/lee-dohm"><span class="octicon octicon-mark-github"></span></a>&nbsp;&nbsp;
              <a href="http://stackoverflow.com/users/1954/lee"><i class="fa fa-stack-exchange"></i></a>&nbsp;&nbsp;
              <a href="https://twitter.com/leedohm"><i class="fa fa-twitter"></i></a>
            </p>
            <p>
              Copyright &copy; 2010-2016 by Lee Dohm
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="//code.jquery.com/jquery.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/javascripts/lightbox.min.js"></script>
    <script src="/javascripts/bigfoot.min.js"></script>
    <script type="text/javascript">
      $.bigfoot();
    </script>
  </body>
</html>
